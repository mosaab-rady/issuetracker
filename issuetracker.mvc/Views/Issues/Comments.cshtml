@model CommentsOnIssueViewModel
@{
	var issueId = ViewBag.issueId;
	ViewData["Title"] = "Discussion";
}

<div class="container-fluid my-3 px-4">
	<div class="row mx-md-3">

		<div class="col-12">
			<h4 class="text-primary text-capitalize">@Model.IssueTitle</h4>
		</div>

		<div class="col-md-7 mt-3 border-bottom">
			<h6 class="text-muted border-bottom mb-0 border-2 border-primary pe-3" style="width: fit-content;">Comments</h6>
		</div>


		<div class="col-md-7 ms-md-4 my-3" style="max-height: 60vh; overflow-y: scroll;" id="CommentsDiv">
			@foreach (var comment in Model.Comments)
			{
				<div class="my-4">
					<div class="d-flex align-items-center">
						<img src="/img/@comment.UserImage" class="rounded-circle boxshadow me-3" width="30px" height="30px" alt="">
						<div class="d-flex gap-3">
							<p class="text-muted mb-0">@comment.UserName
								<span class="text-muted mb-0" style="font-size: 0.8rem;">
									commented
									@comment.CreatedOn
								</span>
							</p>
						</div>
					</div>
					<div class="px-5 mt-2">
						@foreach (var p in comment.CommentText.Split("\r\n"))
						{
							<p class="mb-0">
								@p
							</p>
						}
					</div>
				</div>
			}
		</div>


		<div class="col-md-7 ms-md-4 px-0">
			<form asp-action="createComment" asp-controller="issues" asp-route-issueId="@issueId" method="post">
				<textarea asp-for="@Model.CreateComment.Comment" name="Comment" rows="3" placeholder="Type Comment"
					class="form-control"></textarea>
				<input type="hidden" name="IssueId" value="@issueId">
				<div class="text-danger" asp-validation-summary="All"></div>
				<div class="text-end mt-3">
					<input type="submit" value="Comment" class="btn btn-outline-primary">
				</div>
			</form>
		</div>

	</div>
</div>
</div>

@section Scripts {
@{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}


<script>
	var element = document.getElementById("CommentsDiv");
	element.scrollTop = element.scrollHeight;
</script>